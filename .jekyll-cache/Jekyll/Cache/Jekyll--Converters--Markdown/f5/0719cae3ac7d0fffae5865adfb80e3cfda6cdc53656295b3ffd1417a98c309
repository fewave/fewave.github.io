I"˜˜<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­ï¼Œç»å¸¸éƒ½éœ€è¦ä¸€ä¸ªå…¨å±€çš„IDç”Ÿæˆå™¨ï¼Œæ¥ä¿è¯ç³»ç»Ÿä¸­æŸäº›ä¸šåŠ¡åœºæ™¯ä¸­å¯¹äºä¸»é”®çš„è¦æ±‚ï¼Œå½“å‰å®ç°IDç”Ÿæˆçš„æ–¹å¼è¿˜æ˜¯æŒºå¤šçš„ã€‚æœ¬æ–‡æˆ‘ä»¬æ¥è°ˆè°ˆå¸¸è§çš„IDç”Ÿæˆæ–¹å¼ã€‚
<strong>å…¨å±€IDè¯¥æœ‰çš„ç‰¹æ€§</strong></p>
<blockquote>
  <ol>
    <li>å”¯ä¸€æ€§: ç¡®ä¿ç”Ÿæˆçš„IDä¸ºå…¨ç½‘å”¯ä¸€</li>
    <li>æœ‰åºæ€§: ç¡®ä¿IDå¯¹äºæŸé¡¹ä¸šåŠ¡æ¥è¯´æ˜¯æœ‰åºæ€§é€’å¢çš„</li>
    <li>æ—¶é—´æˆ³: å¯æ¸…æ¥šçŸ¥é“IDç”Ÿæˆçš„æ—¶é—´ç‚¹</li>
    <li>é«˜å¯ç”¨æ€§: ç¡®ä¿ä»»ä½•æ—¶é—´éƒ½èƒ½ç”Ÿæˆæœ‰æ•ˆID</li>
  </ol>
</blockquote>

<p>##å¸¸è§çš„IDç”Ÿæˆæ–¹å¼</p>
<h3 id="ä¸€-uuid">ä¸€. UUID</h3>
<blockquote>
  <p>UUIDæ˜¯ç”±ä¸€ç»„32ä½æ•°çš„16è¿›åˆ¶æ•°å­—æ‰€æ„æˆï¼Œæ˜¯æ•…UUIDç†è®ºä¸Šçš„æ€»æ•°ä¸º16^32=2^128ï¼Œçº¦ç­‰äº3.4 x 10^38ã€‚ä¹Ÿå°±æ˜¯è¯´è‹¥æ¯çº³ç§’äº§ç”Ÿ1å…†ä¸ªUUIDï¼Œè¦èŠ±100äº¿å¹´æ‰ä¼šå°†æ‰€æœ‰UUIDç”¨å®Œã€‚</p>
</blockquote>

<p>UUIDçš„æ ‡å‡†å‹å¼åŒ…å«32ä¸ª16è¿›åˆ¶æ•°å­—ï¼Œä»¥è¿å­—å·åˆ†ä¸ºäº”æ®µï¼Œå½¢å¼ä¸º8-4-4-4-12çš„32ä¸ªå­—ç¬¦ã€‚ç¤ºä¾‹ï¼š550e8400-e29b-41d4-a716-446655440000</p>

<p>JAVA</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.mytest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UTest</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="no">UUID</span> <span class="n">uuid</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">uuid</span><span class="o">);</span>
     <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="ä¼˜ç‚¹">ä¼˜ç‚¹:</h4>
<ul>
  <li>ç®€å•, ä¸€èˆ¬å¼€å‘è¯­è¨€ä¸­éƒ½ä¼šè‡ªå¸¦ç”Ÿæˆæ–¹å¼ã€‚</li>
  <li>æœ¬åœ°ç”Ÿæˆ, ä¸éœ€è¦é¢å¤–çš„ç½‘ç»œæ¶ˆè€—</li>
  <li>æ€§èƒ½é«˜</li>
  <li>æ°´å¹³æ‰©å±•èƒ½åŠ›å¼º
    <h4 id="ç¼ºç‚¹">ç¼ºç‚¹:</h4>
  </li>
  <li>ä¸æ˜“äºå­˜å‚¨, IDæœ‰128bit,å ç”¨ç©ºé—´å¤§</li>
  <li>æ— åºæ€§, å¦‚æœä½œä¸ºæ•°æ®åº“ä¸»é”®ä¼šå½±å“æ€§èƒ½</li>
  <li>æ— æ„ä¹‰, UUIDæ˜¯ä¸€ä¸²æ— è§„åˆ™å­—ç¬¦ä¸², æ— ä»»ä½•ä¸šåŠ¡å«ä¹‰, æ— æ—¶é—´æˆ³ã€‚</li>
</ul>

<h3 id="äºŒ-æ•°æ®åº“è‡ªå¢">äºŒ. æ•°æ®åº“è‡ªå¢</h3>
<p>mysqlæ•°æ®åº“ä½¿ç”¨auto_increment å­—æ®µæ¥è¾…åŠ©ä¸ºIDè‡ªå¢ã€‚
oracleæ•°æ®åº“é€šè¿‡åˆ›å»ºsequence æ¥ç”ŸæˆIDè‡ªå¢ã€‚</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="c1">--ORACLE</span>
<span class="c1">-- åˆ›å»ºsequence</span>
<span class="k">create</span> <span class="n">sequence</span> <span class="n">seq_test</span>
<span class="k">minvalue</span> <span class="mi">1</span>
<span class="k">maxvalue</span> <span class="mi">9999999</span>
<span class="k">start</span> <span class="k">with</span> <span class="mi">1</span>
<span class="k">increment</span> <span class="k">by</span> <span class="mi">1</span>
<span class="k">cache</span> <span class="mi">50</span><span class="p">;</span>

<span class="c1">--å»ºè¡¨</span>
<span class="k">drop</span> <span class="k">table</span> <span class="n">test</span><span class="p">;</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">test</span><span class="p">(</span>
<span class="n">ID</span> <span class="nb">integer</span>
<span class="p">,</span><span class="n">stu_name</span> <span class="n">nvarchar2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">,</span><span class="n">stu_age</span> <span class="n">number</span>
<span class="p">);</span>

<span class="c1">--æ’å…¥æ•°æ®</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test</span> <span class="k">values</span><span class="p">(</span><span class="n">seq_test</span><span class="p">.</span><span class="n">nextval</span><span class="p">,</span><span class="s1">'Mary'</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test</span> <span class="k">values</span><span class="p">(</span><span class="n">seq_test</span><span class="p">.</span><span class="n">nextval</span><span class="p">,</span><span class="s1">'Tom'</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="ä¼˜ç‚¹-1">ä¼˜ç‚¹:</h4>
<ul>
  <li>ç®€å•,æ— éœ€ä»»ä½•é¢å¤–ç¨‹åºæ“ä½œ</li>
</ul>

<h4 id="ç¼ºç‚¹-1">ç¼ºç‚¹:</h4>
<ul>
  <li>é«˜å¹¶å‘æƒ…å†µä¸‹æ€§èƒ½ä¸ä½³</li>
  <li>æ°´å¹³æ‰©å±•å›°éš¾,åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ— æ³•ç¡®ä¿IDå…¨å±€å”¯ä¸€</li>
</ul>

<h3 id="ä¸‰-snowflake">ä¸‰. snowflake</h3>
<blockquote>
  <p>snowflakeæ˜¯Twitterå¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œç»“æœæ˜¯ä¸€ä¸ªlongå‹çš„IDã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šä½¿ç”¨41bitä½œä¸ºæ¯«ç§’æ•°ï¼Œ10bitä½œä¸ºæœºå™¨çš„IDï¼ˆ5ä¸ªbitæ˜¯æ•°æ®ä¸­å¿ƒï¼Œ5ä¸ªbitçš„æœºå™¨IDï¼‰ï¼Œ12bitä½œä¸ºæ¯«ç§’å†…çš„æµæ°´å·ï¼ˆæ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹åœ¨æ¯æ¯«ç§’å¯ä»¥äº§ç”Ÿ 4096 ä¸ª IDï¼‰ï¼Œæœ€åè¿˜æœ‰ä¸€ä¸ªç¬¦å·ä½ï¼Œæ°¸è¿œæ˜¯0ã€‚</p>
</blockquote>

<p><strong><em>snowflakeç®—æ³•çš„ç»„æˆéƒ¨åˆ†:</em></strong></p>
<ol>
  <li>41ä½çš„æ—¶é—´åºåˆ—ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼Œ41ä½çš„é•¿åº¦å¯ä»¥ä½¿ç”¨69å¹´ï¼‰</li>
  <li>10ä½çš„æœºå™¨æ ‡è¯†ï¼ˆ10ä½çš„é•¿åº¦æœ€å¤šæ”¯æŒéƒ¨ç½²1024ä¸ªèŠ‚ç‚¹ï¼‰</li>
  <li>12ä½çš„è®¡æ•°é¡ºåºå·ï¼ˆ12ä½çš„è®¡æ•°é¡ºåºå·æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’äº§ç”Ÿ4096ä¸ªIDåºå·ï¼‰ æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œå§‹ç»ˆä¸º0ã€‚</li>
</ol>

<p><img src="resources/29BF82C3BEFBE076B5FBFF528BFFE2A4.jpg" alt="snowflake-64bit.jpg" /></p>

<p><strong><em>java å®ç°æ–¹å¼</em></strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Twitter_Snowflake&lt;br&gt;
 * SnowFlakeçš„ç»“æ„å¦‚ä¸‹(æ¯éƒ¨åˆ†ç”¨-åˆ†å¼€):&lt;br&gt;
 * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt;
 * 1ä½æ ‡è¯†ï¼Œç”±äºlongåŸºæœ¬ç±»å‹åœ¨Javaä¸­æ˜¯å¸¦ç¬¦å·çš„ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œæ‰€ä»¥idä¸€èˆ¬æ˜¯æ­£æ•°ï¼Œæœ€é«˜ä½æ˜¯0&lt;br&gt;
 * 41ä½æ—¶é—´æˆª(æ¯«ç§’çº§)ï¼Œæ³¨æ„ï¼Œ41ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª)
 * å¾—åˆ°çš„å€¼ï¼‰ï¼Œè¿™é‡Œçš„çš„å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„idç”Ÿæˆå™¨å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šçš„ï¼ˆå¦‚ä¸‹ä¸‹é¢ç¨‹åºIdWorkerç±»çš„startTimeå±æ€§ï¼‰ã€‚41ä½çš„æ—¶é—´æˆªï¼Œå¯ä»¥ä½¿ç”¨69å¹´ï¼Œå¹´T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt;
 * 10ä½çš„æ•°æ®æœºå™¨ä½ï¼Œå¯ä»¥éƒ¨ç½²åœ¨1024ä¸ªèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬5ä½datacenterIdå’Œ5ä½workerId&lt;br&gt;
 * 12ä½åºåˆ—ï¼Œæ¯«ç§’å†…çš„è®¡æ•°ï¼Œ12ä½çš„è®¡æ•°é¡ºåºå·æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’(åŒä¸€æœºå™¨ï¼ŒåŒä¸€æ—¶é—´æˆª)äº§ç”Ÿ4096ä¸ªIDåºå·&lt;br&gt;
 * åŠ èµ·æ¥åˆšå¥½64ä½ï¼Œä¸ºä¸€ä¸ªLongå‹ã€‚&lt;br&gt;
 * SnowFlakeçš„ä¼˜ç‚¹æ˜¯ï¼Œæ•´ä½“ä¸ŠæŒ‰ç…§æ—¶é—´è‡ªå¢æ’åºï¼Œå¹¶ä¸”æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”ŸIDç¢°æ’(ç”±æ•°æ®ä¸­å¿ƒIDå’Œæœºå™¨IDä½œåŒºåˆ†)ï¼Œå¹¶ä¸”æ•ˆç‡è¾ƒé«˜ï¼Œç»æµ‹è¯•ï¼ŒSnowFlakeæ¯ç§’èƒ½å¤Ÿäº§ç”Ÿ26ä¸‡IDå·¦å³ã€‚
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SnowflakeIdWorker</span> <span class="o">{</span>

    <span class="c1">// ==============================Fields===========================================</span>
    <span class="cm">/** å¼€å§‹æ—¶é—´æˆª (2015-01-01) */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">twepoch</span> <span class="o">=</span> <span class="mi">1420041600000L</span><span class="o">;</span>

    <span class="cm">/** æœºå™¨idæ‰€å çš„ä½æ•° */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">workerIdBits</span> <span class="o">=</span> <span class="mi">5L</span><span class="o">;</span>

    <span class="cm">/** æ•°æ®æ ‡è¯†idæ‰€å çš„ä½æ•° */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">datacenterIdBits</span> <span class="o">=</span> <span class="mi">5L</span><span class="o">;</span>

    <span class="cm">/** æ”¯æŒçš„æœ€å¤§æœºå™¨idï¼Œç»“æœæ˜¯31 (è¿™ä¸ªç§»ä½ç®—æ³•å¯ä»¥å¾ˆå¿«çš„è®¡ç®—å‡ºå‡ ä½äºŒè¿›åˆ¶æ•°æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°) */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">maxWorkerId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1L</span> <span class="o">^</span> <span class="o">(-</span><span class="mi">1L</span> <span class="o">&lt;&lt;</span> <span class="n">workerIdBits</span><span class="o">);</span>

    <span class="cm">/** æ”¯æŒçš„æœ€å¤§æ•°æ®æ ‡è¯†idï¼Œç»“æœæ˜¯31 */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">maxDatacenterId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1L</span> <span class="o">^</span> <span class="o">(-</span><span class="mi">1L</span> <span class="o">&lt;&lt;</span> <span class="n">datacenterIdBits</span><span class="o">);</span>

    <span class="cm">/** åºåˆ—åœ¨idä¸­å çš„ä½æ•° */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">sequenceBits</span> <span class="o">=</span> <span class="mi">12L</span><span class="o">;</span>

    <span class="cm">/** æœºå™¨IDå‘å·¦ç§»12ä½ */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">workerIdShift</span> <span class="o">=</span> <span class="n">sequenceBits</span><span class="o">;</span>

    <span class="cm">/** æ•°æ®æ ‡è¯†idå‘å·¦ç§»17ä½(12+5) */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">datacenterIdShift</span> <span class="o">=</span> <span class="n">sequenceBits</span> <span class="o">+</span> <span class="n">workerIdBits</span><span class="o">;</span>

    <span class="cm">/** æ—¶é—´æˆªå‘å·¦ç§»22ä½(5+5+12) */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">timestampLeftShift</span> <span class="o">=</span> <span class="n">sequenceBits</span> <span class="o">+</span> <span class="n">workerIdBits</span> <span class="o">+</span> <span class="n">datacenterIdBits</span><span class="o">;</span>

    <span class="cm">/** ç”Ÿæˆåºåˆ—çš„æ©ç ï¼Œè¿™é‡Œä¸º4095 (0b111111111111=0xfff=4095) */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">sequenceMask</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1L</span> <span class="o">^</span> <span class="o">(-</span><span class="mi">1L</span> <span class="o">&lt;&lt;</span> <span class="n">sequenceBits</span><span class="o">);</span>

    <span class="cm">/** å·¥ä½œæœºå™¨ID(0~31) */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">workerId</span><span class="o">;</span>

    <span class="cm">/** æ•°æ®ä¸­å¿ƒID(0~31) */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">datacenterId</span><span class="o">;</span>

    <span class="cm">/** æ¯«ç§’å†…åºåˆ—(0~4095) */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">sequence</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>

    <span class="cm">/** ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">lastTimestamp</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1L</span><span class="o">;</span>

    <span class="c1">//==============================Constructors=====================================</span>
    <span class="cm">/**
     * æ„é€ å‡½æ•°
     * @param workerId å·¥ä½œID (0~31)
     * @param datacenterId æ•°æ®ä¸­å¿ƒID (0~31)
     */</span>
    <span class="kd">public</span> <span class="nf">SnowflakeIdWorker</span><span class="o">(</span><span class="kt">long</span> <span class="n">workerId</span><span class="o">,</span> <span class="kt">long</span> <span class="n">datacenterId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">workerId</span> <span class="o">&gt;</span> <span class="n">maxWorkerId</span> <span class="o">||</span> <span class="n">workerId</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"worker Id can't be greater than %d or less than 0"</span><span class="o">,</span> <span class="n">maxWorkerId</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">datacenterId</span> <span class="o">&gt;</span> <span class="n">maxDatacenterId</span> <span class="o">||</span> <span class="n">datacenterId</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"datacenter Id can't be greater than %d or less than 0"</span><span class="o">,</span> <span class="n">maxDatacenterId</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">workerId</span> <span class="o">=</span> <span class="n">workerId</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">datacenterId</span> <span class="o">=</span> <span class="n">datacenterId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// ==============================Methods==========================================</span>
    <span class="cm">/**
     * è·å¾—ä¸‹ä¸€ä¸ªID (è¯¥æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„)
     * @return SnowflakeId
     */</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">long</span> <span class="nf">nextId</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">timeGen</span><span class="o">();</span>

        <span class="c1">//å¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡IDç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œè¯´æ˜ç³»ç»Ÿæ—¶é’Ÿå›é€€è¿‡è¿™ä¸ªæ—¶å€™åº”å½“æŠ›å‡ºå¼‚å¸¸</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">timestamp</span> <span class="o">&lt;</span> <span class="n">lastTimestamp</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span>
                    <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Clock moved backwards.  Refusing to generate id for %d milliseconds"</span><span class="o">,</span> <span class="n">lastTimestamp</span> <span class="o">-</span> <span class="n">timestamp</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="c1">//å¦‚æœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ—</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">lastTimestamp</span> <span class="o">==</span> <span class="n">timestamp</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="o">(</span><span class="n">sequence</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">sequenceMask</span><span class="o">;</span>
            <span class="c1">//æ¯«ç§’å†…åºåˆ—æº¢å‡º</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">sequence</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,è·å¾—æ–°çš„æ—¶é—´æˆ³</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">tilNextMillis</span><span class="o">(</span><span class="n">lastTimestamp</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½®</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">//ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª</span>
        <span class="n">lastTimestamp</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">;</span>

        <span class="c1">//ç§»ä½å¹¶é€šè¿‡æˆ–è¿ç®—æ‹¼åˆ°ä¸€èµ·ç»„æˆ64ä½çš„ID</span>
        <span class="k">return</span> <span class="o">((</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">twepoch</span><span class="o">)</span> <span class="o">&lt;&lt;</span> <span class="n">timestampLeftShift</span><span class="o">)</span> <span class="c1">//</span>
                <span class="o">|</span> <span class="o">(</span><span class="n">datacenterId</span> <span class="o">&lt;&lt;</span> <span class="n">datacenterIdShift</span><span class="o">)</span> <span class="c1">//</span>
                <span class="o">|</span> <span class="o">(</span><span class="n">workerId</span> <span class="o">&lt;&lt;</span> <span class="n">workerIdShift</span><span class="o">)</span> <span class="c1">//</span>
                <span class="o">|</span> <span class="n">sequence</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œç›´åˆ°è·å¾—æ–°çš„æ—¶é—´æˆ³
     * @param lastTimestamp ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª
     * @return å½“å‰æ—¶é—´æˆ³
     */</span>
    <span class="kd">protected</span> <span class="kt">long</span> <span class="nf">tilNextMillis</span><span class="o">(</span><span class="kt">long</span> <span class="n">lastTimestamp</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">timeGen</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">timestamp</span> <span class="o">&lt;=</span> <span class="n">lastTimestamp</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">timeGen</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">timestamp</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * è¿”å›ä»¥æ¯«ç§’ä¸ºå•ä½çš„å½“å‰æ—¶é—´
     * @return å½“å‰æ—¶é—´(æ¯«ç§’)
     */</span>
    <span class="kd">protected</span> <span class="kt">long</span> <span class="nf">timeGen</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">//==============================Test=============================================</span>
    <span class="cm">/** æµ‹è¯• */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SnowflakeIdWorker</span> <span class="n">idWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SnowflakeIdWorker</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">idWorker</span><span class="o">.</span><span class="na">nextId</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="na">toBinaryString</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ä¼˜ç‚¹-2">ä¼˜ç‚¹:</h3>
<ul>
  <li>æ€§èƒ½å¥½,ä½å»¶æ—¶, èƒ½æ»¡è¶³Twitteræ¯ç§’ä¸Šä¸‡æ¡è¯·æ±‚</li>
  <li>ç‹¬ç«‹éƒ¨ç½², ç¨³å®šæ€§é«˜</li>
  <li>å¯æ ¹æ®è‡ªèº«ä¸šåŠ¡åˆ†é…bitä½, çµæ´»æ€§å¥½
    <h3 id="ç¼ºç‚¹-2">ç¼ºç‚¹:</h3>
  </li>
  <li>å¼ºä¾èµ–æœºå™¨æ—¶é—´, å¦‚æœæœºå™¨ä¸Šæ—¶é—´å›æ‹¨,ä¼šå¯¼è‡´å‘å·é‡å¤æˆ–è€…æœåŠ¡ä¼šå¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</li>
</ul>

<h3 id="å››-rediså®ç°å…¨å±€idç”Ÿæˆå™¨">å››. Rediså®ç°å…¨å±€IDç”Ÿæˆå™¨</h3>
<p>å®šä¹‰ä¸€ä¸ªé€šç”¨çš„keyï¼Œè¯¥keyçš„è§„åˆ™æ˜¯æ—¶é—´æ ¼å¼ï¼Œç²¾ç¡®åˆ°ç§’ï¼Œä¿è¯æ¯ç§’éƒ½æ˜¯ä¸åŒçš„key(<strong><em>å½“ç„¶keyçš„è§„åˆ™å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡éœ€æ±‚è¿›è¡Œå®šåˆ¶</em></strong>)ï¼Œvalueçš„å€¼æ˜¯ä¸€ä¸ªlongå‹çš„æ•´æ•°ï¼Œå‰åŠéƒ¨åˆ†æ˜¯å½“å‰æ—¶é—´ç²¾ç¡®åˆ°ç§’ï¼Œåé¢æ˜¯è‡ªå¢çš„å€¼ï¼Œè®¾è®¡æˆ5ä½ï¼Œä¸å¤Ÿçš„è¡¥0ï¼Œè¿™æ ·åŸºæœ¬å°±æ˜¯æ¯ç§’æœ€å¤šèƒ½ç”Ÿæˆ99999ä¸ªIDï¼ŒåŸºæœ¬èƒ½æ»¡è¶³å¤§éƒ¨åˆ†çš„éœ€æ±‚ï¼Œå¦‚æœéœ€è¦æ›´å¤šï¼Œå¯ä»¥å¤šä¿ç•™å‡ ä½å°±è¡Œã€‚
<strong><em>java å®ç°æ–¹å¼</em></strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * ä½¿ç”¨redisç”Ÿæˆåˆ†å¸ƒå¼ID
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IdGeneratorService</span> <span class="o">{</span>

    <span class="cm">/**
     * @param biz ä¸šåŠ¡åç§°
     */</span>
    <span class="kt">long</span> <span class="nf">generatorId</span><span class="o">(</span><span class="nc">String</span> <span class="n">biz</span><span class="o">);</span>

    <span class="cm">/**
     *
     * @return
     */</span>
    <span class="kt">long</span> <span class="nf">generatorId</span><span class="o">();</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.base.Strings</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.ValueOperations</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Calendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisIdGeneratorService</span> <span class="kd">implements</span> <span class="nc">IdGeneratorService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">keyPrefix</span> <span class="o">=</span> <span class="s">"smart"</span><span class="o">;</span>

    <span class="cm">/**
     * JedisClientå¯¹è±¡
     */</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">RedisTemplate</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">redisTemplate</span><span class="o">;</span>


    <span class="cm">/**
     * @Description
     * @author butterfly
     */</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getIDPrefix</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
        <span class="nc">Calendar</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="n">c</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">year</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">YEAR</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">day</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">DAY_OF_YEAR</span><span class="o">);</span> <span class="c1">// ä»Šå¤©æ˜¯ç¬¬å¤šå°‘å¤©</span>
        <span class="kt">int</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">HOUR_OF_DAY</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">minute</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MINUTE</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">second</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">SECOND</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">dayFmt</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%1$03d"</span><span class="o">,</span> <span class="n">day</span><span class="o">);</span> <span class="c1">// 0è¡¥ä½æ“ä½œ å¿…é¡»æ»¡è¶³ä¸‰ä½</span>
        <span class="nc">String</span> <span class="n">hourFmt</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%1$02d"</span><span class="o">,</span> <span class="n">hour</span><span class="o">);</span>  <span class="c1">// 0è¡¥ä½æ“ä½œ å¿…é¡»æ»¡è¶³2ä½</span>
        <span class="nc">String</span> <span class="n">minuteFmt</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%1$02d"</span><span class="o">,</span> <span class="n">minute</span><span class="o">);</span>  <span class="c1">// 0è¡¥ä½æ“ä½œ å¿…é¡»æ»¡è¶³2ä½</span>
        <span class="nc">String</span> <span class="n">secondFmt</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%1$02d"</span><span class="o">,</span> <span class="n">second</span><span class="o">);</span>  <span class="c1">// 0è¡¥ä½æ“ä½œ å¿…é¡»æ»¡è¶³2ä½</span>
        <span class="nc">StringBuffer</span> <span class="n">prefix</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
        <span class="n">prefix</span><span class="o">.</span><span class="na">append</span><span class="o">((</span><span class="n">year</span> <span class="o">-</span> <span class="mi">2000</span><span class="o">)).</span><span class="na">append</span><span class="o">(</span><span class="n">dayFmt</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">hourFmt</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">minuteFmt</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">secondFmt</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">prefix</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="cm">/**
     * @author butterfly
     */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="nf">incrDistrId</span><span class="o">(</span><span class="nc">String</span> <span class="n">biz</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">getIDPrefix</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">orderId</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">key</span> <span class="o">=</span> <span class="s">"#{biz}:id:"</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">"#{biz}"</span><span class="o">,</span> <span class="n">biz</span><span class="o">).</span><span class="na">concat</span><span class="o">(</span><span class="n">prefix</span><span class="o">);</span> <span class="c1">// 00001</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">ValueOperations</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">valueOper</span> <span class="o">=</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">();</span>
            <span class="nc">Long</span> <span class="n">index</span> <span class="o">=</span> <span class="n">valueOper</span><span class="o">.</span><span class="na">increment</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
            <span class="n">orderId</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%1$05d"</span><span class="o">,</span> <span class="n">index</span><span class="o">));</span> <span class="c1">// è¡¥ä½æ“ä½œ ä¿è¯æ»¡è¶³5ä½</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"åˆ†å¸ƒå¼è®¢å•å·ç”Ÿæˆå¤±è´¥å¼‚å¸¸ã€‚ã€‚ã€‚ã€‚ã€‚"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">expire</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="mi">600</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span><span class="c1">//ä¿ç•™10åˆ†é’Ÿå†…çš„key</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">Strings</span><span class="o">.</span><span class="na">isNullOrEmpty</span><span class="o">(</span><span class="n">orderId</span><span class="o">))</span> <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">return</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">orderId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * @Description ç”Ÿæˆåˆ†å¸ƒå¼ID
     * @author butterfly
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">generatorId</span><span class="o">(</span><span class="nc">String</span> <span class="n">biz</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// è½¬æˆæ•°å­—ç±»å‹ï¼Œå¯æ’åº</span>
        <span class="k">return</span> <span class="nf">incrDistrId</span><span class="o">(</span><span class="n">biz</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">generatorId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">incrDistrId</span><span class="o">(</span><span class="n">keyPrefix</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ä¼˜ç‚¹-3">ä¼˜ç‚¹:</h3>
<ul>
  <li>èƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸Šä¿æŒIdå…·æœ‰ä¸€å®šçš„å¢é•¿è§„å¾‹ï¼Œæœ‰åˆ©äºç´¢å¼•å’Œæ’åº</li>
  <li>æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œå®šåˆ¶ä¸åŒçš„IDçš„æ ¼å¼</li>
</ul>

<h3 id="ç¼ºç‚¹-3">ç¼ºç‚¹:</h3>
<ul>
  <li>ä¾èµ–äºRedisï¼Œéœ€è¦å¼•å…¥Redisä¸­é—´ä»¶çš„é…ç½®</li>
  <li>å¢åŠ è¿ç»´æˆæœ¬</li>
</ul>

<h3 id="äº”-ç¾å›¢leaf">äº”. ç¾å›¢Leaf</h3>
<blockquote>
  <p>Leafæ˜¯ç¾å›¢åŸºç¡€ç ”å‘å¹³å°æ¨å‡ºçš„ä¸€ä¸ªåˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡ï¼Œåå­—å–è‡ªå¾·å›½å“²å­¦å®¶ã€æ•°å­¦å®¶è±å¸ƒå°¼èŒ¨çš„ä¸€å¥è¯ï¼šâ€œThere are no two identical leaves in the world.â€Leafå…·å¤‡é«˜å¯é ã€ä½å»¶è¿Ÿã€å…¨å±€å”¯ä¸€ç­‰ç‰¹ç‚¹ã€‚</p>
</blockquote>

<p>Leafèƒ½ä¿è¯å…¨å±€å”¯ä¸€æ€§ã€è¶‹åŠ¿é€’å¢ã€å•è°ƒé€’å¢ã€ä¿¡æ¯å®‰å…¨ï¼Œé‡Œé¢ä¹Ÿæåˆ°äº†å‡ ç§åˆ†å¸ƒå¼æ–¹æ¡ˆçš„å¯¹æ¯”ï¼Œä½†ä¹Ÿéœ€è¦ä¾èµ–å…³ç³»æ•°æ®åº“ã€Zookeeperç­‰ä¸­é—´ä»¶,è¿™é‡Œå°±ä¸å†è¯¦ç»†å±•å¼€,æœ‰å…´è¶£å¯å‚è€ƒæ­¤å‰ç¾å›¢æŠ€æœ¯åšå®¢çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">ã€ŠLeafç¾å›¢åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡ã€‹</a>
Leafé¡¹ç›®Githubåœ°å€: <a href="https://github.com/Meituan-Dianping/Leaf">https://github.com/Meituan-Dianping/Leaf</a></p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è¿™ç¯‡æ–‡ç« åˆ—ä¸¾äº†å‡ ç§å¸¸è§çš„å…¨å±€IDç”Ÿæˆæ–¹æ¡ˆ, æ¯ç§æ–¹å¼æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨çš„åœºæ™¯ã€‚åœ¨å®é™…çš„å·¥ä½œä¸­ï¼Œéœ€è¦ç»“åˆè‡ªèº«çš„å·¥ä½œç¯å¢ƒå’Œä¸šåŠ¡éœ€æ±‚, è¿›è¡Œåˆç†é€‰å‹ã€‚
<strong><em>æ²¡æœ‰æœ€å¥½çš„æ–¹æ¡ˆï¼Œåªæœ‰æœ€é€‚åˆçš„æ–¹æ¡ˆã€‚</em></strong></p>
:ET